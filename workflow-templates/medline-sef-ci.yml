name: Medline Blue-Green Deployment Strategy ( Azure Spring )

on:
  push:
    branches: [ $default-branch ]
  pull_request:
    branches: [ $default-branch ]

jobs:
  security:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout GitHub Action
            uses: actions/checkout@v2
          
          - name: Security- Run Prisma Cloud Scan
            id: prisma-cloud
            uses: bridgecrewio/checkov-action@master 
            env:
              PRISMA_API_URL: https://api3.prismacloud.io
            with:
              api-key: ${{ secrets.BC_API_KEY }}
  build:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4
          - name: Login via Azure CLI
            uses: azure/login@v1
            with:
              creds: ${{ secrets.AZURE_CREDENTIALS }}
    
          - name: Deploy to target env step with source code in the Enterprise plan
            uses: azure/spring-apps-deploy@v1
            with:
              azure-subscription: ${{ env.AZURE_SUBSCRIPTION }}
              action: deploy
              service-name: ${{ env.AZURE_SPRING_SERVICE_NAME }}
              app-name: ${{ env.SPRING_APP_NAME }}
              use-staging-deployment: true
              package: ${{ env.ASC_PACKAGE_PATH }}
              builder: 'default'
